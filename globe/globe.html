<!DOCTYPE html>

<html lang="en">

<head>

  <meta charset="utf-8">

  <!-- Include the CesiumJS JavaScript and CSS files -->

  <script src="https://cesium.com/downloads/cesiumjs/releases/1.126/Build/Cesium/Cesium.js"></script>

  <link href="https://cesium.com/downloads/cesiumjs/releases/1.126/Build/Cesium/Widgets/widgets.css" rel="stylesheet">

</head>

<body>

  <div id="cesiumContainer"></div>

  <script type="module">
    // Your access token can be found at: https://ion.cesium.com/tokens.
    // Replace `your_access_token` with your Cesium ion access token.


    Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIxNTk0Y2NjNy0zYjUzLTRhYjYtOWQzMy02ZjI5NDVjYjdkMTkiLCJpZCI6Mjc5OTg2LCJpYXQiOjE3NDE1OTk5ODV9.XjXypSIno5Dkg0PCKECD4vRG1EFDnICMIRKldH2A7uc';

    // Initialize the Cesium Viewer in the HTML element with the `cesiumContainer` ID.
    const viewer = new Cesium.Viewer('cesiumContainer', {
      terrain: Cesium.Terrain.fromWorldTerrain(),
      animation: false,
      timeline: false,
    }); 
    
    var imagery = Cesium.createDefaultImageryProviderViewModels();

    //LABEL 
/*var viewer = new Cesium.Viewer('cesiumContainer', {
    imageryProviderViewModels: imagery,
    selectedImageryProviderViewModel: imagery[1]
});*/

    // Fly the camera to San Francisco at the given longitude, latitude, and height.
    /*iewer.camera.flyTo({
      destination: Cesium.Cartesian3.fromDegrees(-122.4175, 37.655, 400),
      orientation: {
        heading: Cesium.Math.toRadians(0.0),
        pitch: Cesium.Math.toRadians(-15.0),
      }
    });*/

    // Add Cesium OSM Buildings, a global 3D buildings layer.
    const buildingTileset = await Cesium.createOsmBuildingsAsync();
    viewer.scene.primitives.add(buildingTileset);   

const places = [{name: "Test1", lat: 40, lon: 40}, {name: "Test2", lat: 20, lon: 40},{name: "Test3", lat: 40, lon: 20},{name: "Test4", lat: -40, lon: 40},{name: "Test5", lat: 40, lon: -40},{name: "Test6", lat: -40, lon: 0},{name: "Test7", lat: 0, lon: 0},]
const point = {
    pixelSize: 10,
    color: Cesium.Color.RED,
    outlineColor: Cesium.Color.WHITE,
    outlineWidth: 2,
  }
for (let place of places) {
    const position = Cesium.Cartesian3.fromDegrees(place.lon, place.lat);

    // Interroge l'altitude du terrain à cet endroit
    Cesium.sampleTerrainMostDetailed(viewer.terrainProvider, [Cesium.Cartographic.fromDegrees(place.lon, place.lat)])
        .then((updatedPositions) => {
            const height = updatedPositions[0].height || 0; // Hauteur du terrain
            const adjustedHeight = height + 100; // On ajoute 100m pour éviter tout enfouissement

            const adjustedPosition = Cesium.Cartesian3.fromDegrees(place.lon, place.lat, adjustedHeight);

            viewer.entities.add({
                name: place.name,
                position: adjustedPosition,
                point: {
                    pixelSize: 10,
                    color: Cesium.Color.RED,
                    heightReference: Cesium.HeightReference.NONE // Désactiver le clamp pour qu'il respecte l'altitude fixée
                },
                label: {
                    text: place.name,
                    font: "14pt monospace",
                    style: Cesium.LabelStyle.FILL_AND_OUTLINE,
                    outlineWidth: 2,
                    verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                    pixelOffset: new Cesium.Cartesian2(0, -9),
                    heightReference: Cesium.HeightReference.NONE
                }
            });
        });
}
</script>

 </div>

</body>

</html>
