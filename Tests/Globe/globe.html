<!DOCTYPE html>

<html lang="en">

<head> 

  <meta charset="utf-8">

  <!-- Include the CesiumJS JavaScript and CSS files -->

  <script src="https://cesium.com/downloads/cesiumjs/releases/1.126/Build/Cesium/Cesium.js"></script>

  <link href="https://cesium.com/downloads/cesiumjs/releases/1.126/Build/Cesium/Widgets/widgets.css" rel="stylesheet">

<style>
.cesium-sceneModePicker-dropDown-icon[data-bind*="COLUMBUS_VIEW"] {
        display: none;
		}
		.cesium-widget-credits {
			display: none !important;
		}
		#cesium-viewer {
			width: 100%;
			height: 150%;
		}
        body {
            background-color: black;
        }
        button.cesium-infoBox-camera {
  display: none;
}
</style>
</head>

<body>

  <div id="cesiumContainer"></div>

  <script type="module">
    // Your access token can be found at: https://ion.cesium.com/tokens.
    // Replace `your_access_token` with your Cesium ion access token.


    Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJjYzdjMDI0Yy1lNmRjLTRlNGQtODhlNC03MDk2YTFiOTkwZjIiLCJpZCI6Mjg1MDU5LCJpYXQiOjE3NDIyMTU0NTl9.O5SAKSAFH-6ir1VBpZPCduvvTJGKbNWiR6ivpwMBL-o';

    // Initialize the Cesium Viewer in the HTML element with the `cesiumContainer` ID.
    const viewer = new Cesium.Viewer('cesiumContainer', {
      terrain: Cesium.Terrain.fromWorldTerrain(),
      animation: false,
      timeline: false,
    }); 

    viewer.scene.screenSpaceCameraController.minimumZoomDistance = 6378137 * 0.05
    
    var imagery = Cesium.createDefaultImageryProviderViewModels();

    //LABEL 
/*var viewer = new Cesium.Viewer('cesiumContainer', {
    imageryProviderViewModels: imagery,
    selectedImageryProviderViewModel: imagery[1]
});*/

    // Fly the camera to San Francisco at the given longitude, latitude, and height.
    /*iewer.camera.flyTo({
      destination: Cesium.Cartesian3.fromDegrees(-122.4175, 37.655, 400),
      orientation: {
        heading: Cesium.Math.toRadians(0.0),
        pitch: Cesium.Math.toRadians(-15.0),
      }
    });*/

    // Add Cesium OSM Buildings, a global 3D buildings layer.
    const buildingTileset = await Cesium.createOsmBuildingsAsync();
    viewer.scene.primitives.add(buildingTileset);   

const places = []//PASTE Monuments JSON here (it should be an array);
const point = {
    pixelSize: 10,
    color: Cesium.Color.RED,
    outlineColor: Cesium.Color.WHITE,
    outlineWidth: 2,
  }
for (let place of places) {
    const position = Cesium.Cartesian3.fromDegrees(place.coordinates.lon, place.coordinates.lat);

    // Interroge l'altitude du terrain à cet endroit
    Cesium.sampleTerrainMostDetailed(viewer.terrainProvider, [Cesium.Cartographic.fromDegrees(place.coordinates.lon, place.coordinates.lat)])
        .then((updatedPositions) => {
            const height = updatedPositions[0].height || 0; // Hauteur du terrain
            const adjustedHeight = height + 2000; // On ajoute 2000m pour éviter tout enfouissement

            const adjustedPosition = Cesium.Cartesian3.fromDegrees(place.coordinates.lon, place.coordinates.lat, adjustedHeight);

            const entity = viewer.entities.add({
                name: place.site,
				description: place.short_description + '<a target="_blank" href="gogole.com">Page de détails</a>',
                position: adjustedPosition,
                point: {
                    pixelSize: 10,
                    color: Cesium.Color.RED,
                    heightReference: Cesium.HeightReference.NONE // Désactiver le clamp pour qu'il respecte l'altitude fixée
                },
                label: {
                    text: place.site,
                    font: "14pt monospace",
                    style: Cesium.LabelStyle.FILL_AND_OUTLINE,
                    outlineWidth: 2,
                    verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                    pixelOffset: new Cesium.Cartesian2(0, -20),
                    heightReference: Cesium.HeightReference.NONE,
                    show: false // Masqué par défaut
                }
            });

            entity._distanceLabelUpdate = function (mousePosition) {
                if (!mousePosition) return;
                const distance = Cesium.Cartesian3.distance(mousePosition, adjustedPosition);
                entity.label.show = distance < 55000; // Affiche si la distance est < 10 km 99998
            };
        });
}

// Suivi de la souris et mise à jour des labels
const handler = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas);
handler.setInputAction(function (movement) {
    const ray = viewer.camera.getPickRay(movement.endPosition);
    const cartesian = viewer.scene.globe.pick(ray, viewer.scene);
    if (cartesian) {
        viewer.entities.values.forEach(entity => {
            if (entity._distanceLabelUpdate) {
                entity._distanceLabelUpdate(cartesian);
            }
        });
    }
}, Cesium.ScreenSpaceEventType.MOUSE_MOVE);

</script>

 </div>

</body>

<button onclick="window.location.href='google.com'">AAAAAAAAAAAAAAAAAA</button>
<a href="gogole.com">BBBBBBBBBBBBBBBBBBBBBBB</a>
</html>